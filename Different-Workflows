Different workflow files

13 July 2025
14:03

ok now coming to up github actions workflow setup in my project.  I mean for the below workflow 
name: EKS Kubectl Ops

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  kubectl-ops:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
          aws-region: us-east-1

      - name: Update kubeconfig
        run: aws eks update-kubeconfig --region us-east-1 --name dev-cluster

      - name: Run kubectl commands
        run: |
          kubectl get nodes

here in my project we have dev, test, pref and prod environmnets and in each environment we have a eks cluster. So my lead is telling as "For differenet environments we can create different workflow files in same repo or can add a dropdown to select environment".
Could you please help me with "different workflow files in same repo" now first ?


Absolutely, Rohan â€” letâ€™s tackle the â€œseparate workflow files per environmentâ€ approach in GitHub Actions. This method is clean and modular, especially when each environment (dev, test, pref, prod) has its own EKS cluster with its own role ARN and config.


ğŸ—‚ï¸ Separate Workflow Files â€” Structure
Each file lives in .github/workflows/ and handles a specific environment. Hereâ€™s a recommended layout:
.github/workflows/
â”œâ”€â”€ eks-dev.yml
â”œâ”€â”€ eks-test.yml
â”œâ”€â”€ eks-pref.yml
â””â”€â”€ eks-prod.yml



ğŸ”§ Example: eks-dev.yml
name: EKS Kubectl Ops - Dev

on:
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  kubectl-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

- name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_ARN_DEV }}
          aws-region: us-east-1

- name: Update kubeconfig
        run: aws eks update-kubeconfig --region us-east-1 --name dev-cluster

- name: Run kubectl commands
        run: |
          kubectl get pods -A
          kubectl get secrets -A

ğŸ” For each workflow, add the appropriate secret in your GitHub repo settings:
	â€¢ AWS_ROLE_ARN_DEV
	â€¢ AWS_ROLE_ARN_TEST
	â€¢ AWS_ROLE_ARN_PREF
	â€¢ AWS_ROLE_ARN_PROD
You can also change the cluster name and region per workflow.


ğŸ§  Benefits of This Approach
Feature	Benefit
ğŸ§­ Clear separation	Each environment gets its own file â€” easier to audit and manage
ğŸ” Scoped secrets	Different IAM roles and cluster names per env â†’ security boundary
ğŸ›  Modular automation	You can update workflows independently (e.g., redeploy dev without touching prod)
ğŸš€ Parallel runs	Run different environment workflows simultaneously


